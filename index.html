<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pina Go</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
    margin: 0;
    font-family: 'Roboto', sans-serif;
    background-color: #0d1b0d;
    color: white;
    overflow-x: hidden;
}

/* Hero Carousel */
.hero-carousel {
    position: relative;
    width: 100%;
    height: 500px;
    overflow: hidden;
}

.hero-slide {
    position: absolute;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 30px;
    opacity: 0;
    transition: opacity 1s ease-in-out;
}

.hero-slide.active {
    opacity: 1;
}

.hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to top, rgba(13,27,13,0.9), rgba(13,27,13,0.2));
    z-index: 1;
}

.hero-content {
    position: relative;
    z-index: 2;
}

/* Movie Rows */
.movie-row {
    display: flex;
    overflow: hidden;
    padding: 20px 30px;
    scroll-behavior: smooth;
}

.movie-card {
    flex: 0 0 auto;
    margin-right: 20px;
    width: 200px;
    cursor: pointer;
    outline: none;
}

.movie-card img {
    width: 100%;
    height: 300px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.6);
    border: 2px solid transparent;
}

.movie-card:focus img {
    border-color: #b0ff5e;
    box-shadow: 0 10px 25px rgba(176,255,94,0.8);
    transform: scale(1.05);
}

.movie-title {
    text-align: center;
    margin-top: 10px;
    font-weight: bold;
    font-size: 1rem;
    color: #b0ff5e;
}

/* Genre Titles */
.genre-title {
    padding-left: 30px;
    color: #b0ff5e;
    font-size: 1.8rem;
    margin-top: 40px;
}

/* Buttons */
.btn-lima {
    background-color: #b0ff5e !important;
    color: #0d1b0d !important;
    font-weight: bold;
    margin-right: 15px;
    border-radius: 5px;
    padding: 10px 20px;
}

/* Hide scrollbar */
.movie-row::-webkit-scrollbar { display: none; }
.movie-row { -ms-overflow-style: none; scrollbar-width: none; }
</style>
</head>
<body>

<!-- Hero Carousel -->
<div class="hero-carousel" id="hero-carousel"></div>

<!-- Genre Sections -->
<div id="genres"></div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyeBAI1zY8sSgd0DKWbyfirotZEGXr7bkvV71bMGXDEUZDvcvUWBJTYfG55BVALT8F-vQ/exec';

let slides = [];
let currentSlide = 0;

async function fetchMovies() {
    const res = await fetch(API_URL);
    const data = await res.json();
    return data;
}

function createHeroCarousel(movies) {
    const hero = document.getElementById('hero-carousel');
    movies.forEach((movie, i) => {
        const div = document.createElement('div');
        div.className = 'hero-slide';
        div.style.backgroundImage = `url('${movie.poster}')`;
        div.innerHTML = `
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h2>${movie.titulo}</h2>
                <p>${movie.sinopsis || 'Sin descripción disponible'}</p>
            </div>
        `;
        hero.appendChild(div);
    });
    slides = document.querySelectorAll('.hero-slide');
    if(slides.length) slides[0].classList.add('active');
    setInterval(() => {
        slides[currentSlide].classList.remove('active');
        currentSlide = (currentSlide + 1) % slides.length;
        slides[currentSlide].classList.add('active');
    }, 4000);
}

function createGenreSections(movies) {
    const genresContainer = document.getElementById('genres');
    const genreMap = {};

    movies.forEach(movie => {
        if(movie.id <= 3) return; // Primeras 3 solo al carrusel
        if(!movie.genero) return; // Sin género no se agrega aquí
        if(!genreMap[movie.genero]) genreMap[movie.genero] = [];
        genreMap[movie.genero].push(movie);
    });

    // Sección de “Recientemente agregadas” (últimas 5 películas)
    const recentMovies = movies.slice(-5).reverse(); 
    const recentSection = document.createElement('div');
    recentSection.innerHTML = `<h2 class="genre-title">Recientemente agregadas</h2>`;
    const recentRow = document.createElement('div');
    recentRow.className = 'movie-row';
    recentMovies.forEach(movie => {
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.tabIndex = 0;
        card.innerHTML = `
            <a href="${movie.video}" target="_blank">
                <img src="${movie.poster}" alt="${movie.titulo}">
                <div class="movie-title">${movie.titulo}</div>
            </a>
        `;
        recentRow.appendChild(card);
    });
    recentSection.appendChild(recentRow);
    genresContainer.appendChild(recentSection);

    // Secciones por género
    for(const genre in genreMap) {
        const moviesInGenre = genreMap[genre];
        const section = document.createElement('div');
        section.innerHTML = `<h2 class="genre-title">${genre.charAt(0).toUpperCase() + genre.slice(1)}</h2>`;
        const row = document.createElement('div');
        row.className = 'movie-row';

        moviesInGenre.forEach(movie => {
            const card = document.createElement('div');
            card.className = 'movie-card';
            card.tabIndex = 0;
            card.innerHTML = `
                <a href="${movie.video}" target="_blank">
                    <img src="${movie.poster}" alt="${movie.titulo}">
                    <div class="movie-title">${movie.titulo}</div>
                </a>
            `;
            row.appendChild(card);
        });

        section.appendChild(row);
        genresContainer.appendChild(section);
    }
}

function enableRemoteNavigation() {
    let focusable = Array.from(document.querySelectorAll('.movie-card'));
    let currentFocus = 0;
    if(focusable.length) focusable[0].focus();

    document.addEventListener('keydown', e => {
        const rowElements = Array.from(document.querySelectorAll('.movie-row'));
        let currentRowIndex = rowElements.findIndex(row => row.contains(document.activeElement));
        let cardsInRow = Array.from(rowElements[currentRowIndex].querySelectorAll('.movie-card'));
        let cardIndex = cardsInRow.indexOf(document.activeElement);

        switch(e.key) {
            case 'ArrowRight':
                if(cardIndex < cardsInRow.length -1) cardsInRow[cardIndex+1].focus();
                break;
            case 'ArrowLeft':
                if(cardIndex > 0) cardsInRow[cardIndex-1].focus();
                break;
            case 'ArrowDown':
                if(currentRowIndex < rowElements.length -1) {
                    let nextRowCards = Array.from(rowElements[currentRowIndex+1].querySelectorAll('.movie-card'));
                    if(nextRowCards.length) nextRowCards[Math.min(cardIndex, nextRowCards.length-1)].focus();
                }
                break;
            case 'ArrowUp':
                if(currentRowIndex > 0) {
                    let prevRowCards = Array.from(rowElements[currentRowIndex-1].querySelectorAll('.movie-card'));
                    if(prevRowCards.length) prevRowCards[Math.min(cardIndex, prevRowCards.length-1)].focus();
                }
                break;
            case 'Enter':
                const link = document.activeElement.querySelector('a');
                if(link) link.click();
                break;
        }
    });
}

// Inicializar
(async function() {
    const movies = await fetchMovies();
    createHeroCarousel(movies.slice(0,3)); // primeras 3 al carrusel
    createGenreSections(movies);
    enableRemoteNavigation();
})();
</script>
</body>
</html>
